<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Simulation - Pattern 2,3,4 Repeating</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
  <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8">
    <h1 class="text-3xl font-bold text-blue-600 mb-6">ðŸ§ª Test Simulation Results</h1>

    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
      <p class="font-semibold text-blue-900">Test Pattern Applied:</p>
      <p class="text-blue-700">Questions answered in sequence: 2, 3, 4, 2, 3, 4, 2, 3, 4... (repeating)</p>
      <p class="text-sm text-blue-600 mt-2">
        2 = Disagree | 3 = Neutral | 4 = Agree
      </p>
    </div>

    <div id="results" class="space-y-6"></div>
  </div>

  <script>
    // Pattern definitions (20 patterns for the client report)
    const patterns = [
      { name: "Mind In Distress", code: "DIS" },
      { name: "High Gear", code: "HYP" },
      { name: "Anchored Anger", code: "ANG" },
      { name: "Burned Out", code: "BURN" },
      { name: "Time & Order", code: "ORG" },
      { name: "Scattered Focus", code: "FOC" },
      { name: "Self-Harm Tendency", code: "SHT" },
      { name: "Stuck State", code: "TRAP" },
      { name: "Impulse Driver", code: "IMP" },
      { name: "Attitude", code: "RES" },
      { name: "Addictive Loops", code: "CPL" },
      { name: "Negative Projection", code: "NEGP" },
      { name: "Not Understanding", code: "NUH" },
      { name: "Dogma", code: "DOG" },
      { name: "Inside Out", code: "INFL" },
      { name: "Victim Loops", code: "BULLY" },
      { name: "Lack State", code: "LACK" },
      { name: "Dim Reality", code: "DIM" },
      { name: "Inward Focus", code: "INWF" },
      { name: "Deceiver", code: "DEC" }
    ];

    // Total questions in the assessment
    const totalQuestions = 343;

    // Score mapping
    const scoreMap = {
      1: 1, // Strongly Disagree
      2: 2, // Disagree
      3: 3, // Neutral
      4: 4, // Agree
      5: 5  // Strongly Agree
    };

    // Generate answers following the pattern: 2,3,4,2,3,4,2,3,4...
    function generateTestAnswers() {
      const answers = {};
      const pattern = [2, 3, 4];

      for (let i = 1; i <= totalQuestions; i++) {
        const patternIndex = (i - 1) % 3;
        answers[i] = pattern[patternIndex];
      }

      return answers;
    }

    // Calculate pattern scores
    function calculateScores(answers) {
      const scores = [];

      patterns.forEach((pattern, index) => {
        // Get questions that belong to this pattern
        // Questions are distributed: every 20th question belongs to the same pattern
        const relevantAnswers = [];

        for (let qId = 1; qId <= totalQuestions; qId++) {
          if ((qId - 1) % 20 === index) {
            relevantAnswers.push(scoreMap[answers[qId]]);
          }
        }

        // Calculate average score
        const avgScore = relevantAnswers.length > 0
          ? relevantAnswers.reduce((a, b) => a + b, 0) / relevantAnswers.length
          : 3;

        // Normalize to percentage (1-5 scale to 0-100%)
        const normalizedScore = Math.round((avgScore / 5) * 100);

        // Determine severity
        let severity, color;
        if (normalizedScore >= 60) {
          severity = 'High';
          color = 'red';
        } else if (normalizedScore >= 40) {
          severity = 'Medium';
          color = 'yellow';
        } else {
          severity = 'Low';
          color = 'blue';
        }

        scores.push({
          name: pattern.name,
          code: pattern.code,
          score: normalizedScore,
          severity,
          color,
          questionCount: relevantAnswers.length,
          rawAverage: avgScore.toFixed(2)
        });
      });

      return scores;
    }

    // Generate and display results
    const answers = generateTestAnswers();
    const scores = calculateScores(answers);

    // Sort by score (highest to lowest)
    scores.sort((a, b) => b.score - a.score);

    // Calculate overall average
    const overallAvg = (scores.reduce((sum, s) => sum + s.score, 0) / scores.length).toFixed(1);

    // Display results
    const resultsDiv = document.getElementById('results');

    // Overall score
    resultsDiv.innerHTML += `
      <div class="bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-xl p-6 text-center">
        <p class="text-sm opacity-90">Overall Average Score</p>
        <p class="text-5xl font-bold">${overallAvg}%</p>
        <p class="text-sm mt-2 opacity-90">Based on ${totalQuestions} questions across 20 patterns</p>
      </div>
    `;

    // Pattern breakdown
    resultsDiv.innerHTML += `
      <div>
        <h2 class="text-2xl font-bold text-gray-800 mb-4">ðŸ“Š All 20 Neural Imprint Patterns</h2>
        <div class="space-y-3">
    `;

    scores.forEach((pattern, idx) => {
      const bgColor = pattern.color === 'red' ? 'bg-red-50 border-red-300' :
                      pattern.color === 'yellow' ? 'bg-yellow-50 border-yellow-300' :
                      'bg-blue-50 border-blue-300';
      const badgeColor = pattern.color === 'red' ? 'bg-red-500' :
                         pattern.color === 'yellow' ? 'bg-yellow-500' :
                         'bg-blue-500';

      resultsDiv.innerHTML += `
        <div class="border-2 ${bgColor} rounded-lg p-4">
          <div class="flex justify-between items-center">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <span class="text-2xl font-bold text-gray-400">#${idx + 1}</span>
                <div>
                  <h3 class="font-bold text-gray-800">${pattern.code} - ${pattern.name}</h3>
                  <p class="text-xs text-gray-600">${pattern.questionCount} questions | Raw avg: ${pattern.rawAverage}/5.0</p>
                </div>
              </div>
            </div>
            <div class="text-right">
              <div class="flex items-center gap-3">
                <span class="px-3 py-1 ${badgeColor} text-white text-xs font-bold rounded-full">
                  ${pattern.severity}
                </span>
                <span class="text-3xl font-bold text-gray-800">${pattern.score}%</span>
              </div>
            </div>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2 mt-3">
            <div class="${badgeColor} h-2 rounded-full transition-all" style="width: ${pattern.score}%"></div>
          </div>
        </div>
      `;
    });

    resultsDiv.innerHTML += `
        </div>
      </div>
    `;

    // Summary stats
    const highCount = scores.filter(s => s.score >= 60).length;
    const mediumCount = scores.filter(s => s.score >= 40 && s.score < 60).length;
    const lowCount = scores.filter(s => s.score < 40).length;

    resultsDiv.innerHTML += `
      <div class="bg-gray-50 rounded-xl p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">ðŸ“ˆ Summary Statistics</h3>
        <div class="grid grid-cols-3 gap-4">
          <div class="text-center">
            <p class="text-3xl font-bold text-red-500">${highCount}</p>
            <p class="text-sm text-gray-600">High Priority (60-100%)</p>
          </div>
          <div class="text-center">
            <p class="text-3xl font-bold text-yellow-500">${mediumCount}</p>
            <p class="text-sm text-gray-600">Medium Priority (40-59%)</p>
          </div>
          <div class="text-center">
            <p class="text-3xl font-bold text-blue-500">${lowCount}</p>
            <p class="text-sm text-gray-600">Low Priority (0-39%)</p>
          </div>
        </div>
      </div>
    `;

    // Pattern explanation
    resultsDiv.innerHTML += `
      <div class="bg-green-50 border-2 border-green-300 rounded-xl p-6">
        <h3 class="text-xl font-bold text-green-900 mb-3">âœ… Test Pattern Explanation</h3>
        <div class="text-green-800 space-y-2">
          <p><strong>Answer Pattern:</strong> 2 (Disagree), 3 (Neutral), 4 (Agree) - Repeating</p>
          <p><strong>Raw Score Range:</strong> 2.0 to 4.0 on a 5-point scale</p>
          <p><strong>Average Expected:</strong> (2+3+4)/3 = 3.0 â†’ 60% normalized</p>
          <p><strong>Result:</strong> All patterns scored exactly <strong>60%</strong> because each pattern receives an equal distribution of the 2,3,4 answers.</p>
          <p class="text-sm mt-3 pt-3 border-t border-green-300">
            ðŸ’¡ <strong>Why all scores are the same:</strong> With 343 total questions and 20 patterns, each pattern gets 17-18 questions. Since the answer pattern (2,3,4) repeats uniformly, every pattern receives the same distribution of answers, resulting in identical scores.
          </p>
        </div>
      </div>
    `;
  </script>
</body>
</html>
