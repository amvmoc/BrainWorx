<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Simulation - Client & Coach Reports</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
  <div class="max-w-7xl mx-auto">
    <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
      <h1 class="text-4xl font-bold text-blue-600 mb-6">üß™ Complete Test Simulation</h1>

      <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
        <p class="font-semibold text-blue-900">Test Pattern Applied:</p>
        <p class="text-blue-700">Questions answered in sequence: 2, 3, 4, 2, 3, 4, 2, 3, 4... (repeating)</p>
        <p class="text-sm text-blue-600 mt-2">
          For Client Report (5-point scale): 2 = Disagree | 3 = Neutral | 4 = Agree
        </p>
        <p class="text-sm text-blue-600">
          For Self-Assessments (4-point scale): 2 = A little true | 3 = Often true | 4 = Completely true
        </p>
      </div>
    </div>

    <!-- Navigation -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
      <div class="flex gap-4 justify-center flex-wrap">
        <button onclick="showSection('client')" id="btn-client" class="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition">
          Client Report (343 Q)
        </button>
        <button onclick="showSection('teen-career')" id="btn-teen-career" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition">
          Teen Career (60 Q)
        </button>
        <button onclick="showSection('teen-adhd')" id="btn-teen-adhd" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition">
          Teen ADHD (48 Q)
        </button>
        <button onclick="showSection('parent-adhd')" id="btn-parent-adhd" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition">
          Parent ADHD (48 Q)
        </button>
      </div>
    </div>

    <!-- Client Report -->
    <div id="section-client" class="bg-white rounded-xl shadow-lg p-8">
      <h2 class="text-3xl font-bold text-gray-800 mb-6">üìä Client Report (Main Assessment)</h2>
      <div id="client-results" class="space-y-6"></div>
    </div>

    <!-- Teen Career Assessment -->
    <div id="section-teen-career" class="hidden bg-white rounded-xl shadow-lg p-8">
      <h2 class="text-3xl font-bold text-gray-800 mb-6">üéØ Teen Career & Future Work/Study</h2>
      <div id="teen-career-results" class="space-y-6"></div>
    </div>

    <!-- Teen ADHD Assessment -->
    <div id="section-teen-adhd" class="hidden bg-white rounded-xl shadow-lg p-8">
      <h2 class="text-3xl font-bold text-gray-800 mb-6">üß† Teen ADHD-Linked Neural Imprint Screener</h2>
      <div id="teen-adhd-results" class="space-y-6"></div>
    </div>

    <!-- Parent ADHD Assessment -->
    <div id="section-parent-adhd" class="hidden bg-white rounded-xl shadow-lg p-8">
      <h2 class="text-3xl font-bold text-gray-800 mb-6">üë®‚Äçüë©‚Äçüëß Parent ADHD-Linked Neural Imprint Screener</h2>
      <div id="parent-adhd-results" class="space-y-6"></div>
    </div>
  </div>

  <script>
    // Navigation
    function showSection(section) {
      // Hide all sections
      ['client', 'teen-career', 'teen-adhd', 'parent-adhd'].forEach(s => {
        document.getElementById(`section-${s}`).classList.add('hidden');
        document.getElementById(`btn-${s}`).classList.remove('bg-blue-600', 'text-white');
        document.getElementById(`btn-${s}`).classList.add('bg-gray-200', 'text-gray-700');
      });

      // Show selected section
      document.getElementById(`section-${section}`).classList.remove('hidden');
      document.getElementById(`btn-${section}`).classList.remove('bg-gray-200', 'text-gray-700');
      document.getElementById(`btn-${section}`).classList.add('bg-blue-600', 'text-white');
    }

    // ============================================
    // CLIENT REPORT (343 Questions, 20 Patterns)
    // ============================================

    const clientPatterns = [
      { name: "Mind In Distress", code: "DIS" },
      { name: "High Gear", code: "HYP" },
      { name: "Anchored Anger", code: "ANG" },
      { name: "Burned Out", code: "BURN" },
      { name: "Time & Order", code: "ORG" },
      { name: "Scattered Focus", code: "FOC" },
      { name: "Self-Harm Tendency", code: "SHT" },
      { name: "Stuck State", code: "TRAP" },
      { name: "Impulse Driver", code: "IMP" },
      { name: "Attitude", code: "RES" },
      { name: "Addictive Loops", code: "CPL" },
      { name: "Negative Projection", code: "NEGP" },
      { name: "Not Understanding", code: "NUH" },
      { name: "Dogma", code: "DOG" },
      { name: "Inside Out", code: "INFL" },
      { name: "Victim Loops", code: "BULLY" },
      { name: "Lack State", code: "LACK" },
      { name: "Dim Reality", code: "DIM" },
      { name: "Inward Focus", code: "INWF" },
      { name: "Deceiver", code: "DEC" }
    ];

    function generateClientReport() {
      const totalQuestions = 343;
      const pattern = [2, 3, 4];
      const answers = {};

      for (let i = 1; i <= totalQuestions; i++) {
        const patternIndex = (i - 1) % 3;
        answers[i] = pattern[patternIndex];
      }

      const scores = clientPatterns.map((p, index) => {
        const relevantAnswers = [];
        for (let qId = 1; qId <= totalQuestions; qId++) {
          if ((qId - 1) % 20 === index) {
            relevantAnswers.push(answers[qId]);
          }
        }

        const avgScore = relevantAnswers.reduce((a, b) => a + b, 0) / relevantAnswers.length;
        const percentage = Math.round((avgScore / 5) * 100);

        let severity = percentage >= 60 ? 'High' : percentage >= 40 ? 'Medium' : 'Low';
        let color = percentage >= 60 ? 'red' : percentage >= 40 ? 'yellow' : 'blue';

        return {
          name: p.name,
          code: p.code,
          score: percentage,
          severity,
          color,
          questionCount: relevantAnswers.length,
          rawAverage: avgScore.toFixed(2)
        };
      });

      scores.sort((a, b) => b.score - a.score);
      const overallAvg = (scores.reduce((sum, s) => sum + s.score, 0) / scores.length).toFixed(1);

      return { scores, overallAvg, totalQuestions };
    }

    // ============================================
    // SELF-ASSESSMENTS (4-point scale)
    // ============================================

    const selfAssessmentImprints = {
      'DIS': 'Dissociation',
      'ANG': 'Emotional Anger',
      'SHT': 'Shattered Worth',
      'LACK': 'Lack',
      'NEG': 'Unmet Needs',
      'BURN': 'Burned Out',
      'DEC': 'Deceiver',
      'INFLUENCE': 'External Influence',
      'TRAP': 'Trapped Environment',
      'VICTIM': 'Victim Mentality',
      'LEFT/RIGHT': 'Brain Balance',
      'CPL': 'Compulsive Patterns',
      'RES': 'Resistance',
      'NAR': 'Narcissism',
      'DOG': 'Dogmatic Thinking'
    };

    const teenCareerImprints = {
      1: 'INFLUENCE', 2: 'INFLUENCE', 3: 'INFLUENCE', 4: 'LEFT/RIGHT', 5: 'LEFT/RIGHT',
      6: 'LEFT/RIGHT', 7: 'RES', 8: 'TRAP', 9: 'LEFT/RIGHT', 10: 'CPL',
      11: 'DEC', 12: 'NAR', 13: 'LEFT/RIGHT', 14: 'DIS', 15: 'DOG',
      16: 'DIS', 17: 'INFLUENCE', 18: 'INFLUENCE', 19: 'NAR', 20: 'INFLUENCE',
      21: 'DOG', 22: 'BURN', 23: 'TRAP', 24: 'LACK', 25: 'DIS',
      26: 'BURN', 27: 'CPL', 28: 'CPL', 29: 'DOG', 30: 'ANG',
      31: 'RES', 32: 'TRAP', 33: 'INFLUENCE', 34: 'RES', 35: 'INFLUENCE',
      36: 'BURN', 37: 'RES', 38: 'CPL', 39: 'DOG', 40: 'NEG',
      41: 'LEFT/RIGHT', 42: 'DIS', 43: 'LEFT/RIGHT', 44: 'DIS', 45: 'LEFT/RIGHT',
      46: 'BURN', 47: 'LEFT/RIGHT', 48: 'INFLUENCE', 49: 'INFLUENCE', 50: 'DOG',
      51: 'CPL', 52: 'RES', 53: 'SHT', 54: 'NEG', 55: 'VICTIM',
      56: 'BURN', 57: 'BURN', 58: 'CPL', 59: 'RES', 60: 'DOG'
    };

    const teenADHDImprints = {
      1: 'DIS', 2: 'DIS', 3: 'DIS', 4: 'DIS', 5: 'DIS', 6: 'DIS',
      7: 'LEFT/RIGHT', 8: 'LEFT/RIGHT', 9: 'LEFT/RIGHT', 10: 'LEFT/RIGHT',
      11: 'BURN', 12: 'BURN', 13: 'BURN', 14: 'BURN',
      15: 'CPL', 16: 'CPL', 17: 'CPL', 18: 'CPL',
      19: 'SHT', 20: 'SHT', 21: 'SHT', 22: 'SHT', 23: 'SHT', 24: 'SHT',
      25: 'RES', 26: 'RES', 27: 'RES', 28: 'RES',
      29: 'VICTIM', 30: 'VICTIM', 31: 'VICTIM', 32: 'VICTIM',
      33: 'INFLUENCE', 34: 'INFLUENCE', 35: 'INFLUENCE', 36: 'INFLUENCE',
      37: 'TRAP', 38: 'TRAP', 39: 'TRAP', 40: 'TRAP',
      41: 'NEG', 42: 'NEG', 43: 'NEG', 44: 'NEG',
      45: 'ANG', 46: 'ANG',
      47: 'DEC', 48: 'DEC'
    };

    function generateSelfAssessment(questionCount, imprintMapping, assessmentName) {
      const pattern = [2, 3, 4];
      const answers = {};

      for (let i = 1; i <= questionCount; i++) {
        const patternIndex = (i - 1) % 3;
        answers[i] = pattern[patternIndex];
      }

      const imprintScores = new Map();

      Object.keys(answers).forEach(qId => {
        const imprint = imprintMapping[qId];
        if (!imprintScores.has(imprint)) {
          imprintScores.set(imprint, []);
        }
        imprintScores.get(imprint).push(answers[qId]);
      });

      const scores = [];
      imprintScores.forEach((scoreArray, code) => {
        const totalScore = scoreArray.reduce((a, b) => a + b, 0);
        const maxScore = scoreArray.length * 4;
        const percentage = Math.round((totalScore / maxScore) * 100);

        let severity = percentage <= 40 ? 'Low' : percentage <= 70 ? 'Moderate' : 'High';
        let color = severity === 'High' ? 'red' : severity === 'Moderate' ? 'yellow' : 'blue';

        scores.push({
          code,
          name: selfAssessmentImprints[code] || code,
          score: percentage,
          severity,
          color,
          questionCount: scoreArray.length,
          rawAverage: (totalScore / scoreArray.length).toFixed(2)
        });
      });

      scores.sort((a, b) => b.score - a.score);
      const overallAvg = (scores.reduce((sum, s) => sum + s.score, 0) / scores.length).toFixed(1);

      return { scores, overallAvg, totalQuestions: questionCount };
    }

    // ============================================
    // RENDER FUNCTIONS
    // ============================================

    function renderReport(data, containerId, title) {
      const container = document.getElementById(containerId);
      let html = '';

      // Overall score
      html += `
        <div class="bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-xl p-6 text-center">
          <p class="text-sm opacity-90">Overall Average Score</p>
          <p class="text-5xl font-bold">${data.overallAvg}%</p>
          <p class="text-sm mt-2 opacity-90">Based on ${data.totalQuestions} questions</p>
        </div>
      `;

      // Pattern breakdown
      html += `<div class="space-y-3">`;
      data.scores.forEach((pattern, idx) => {
        const bgColor = pattern.color === 'red' ? 'bg-red-50 border-red-300' :
                        pattern.color === 'yellow' ? 'bg-yellow-50 border-yellow-300' :
                        'bg-blue-50 border-blue-300';
        const badgeColor = pattern.color === 'red' ? 'bg-red-500' :
                           pattern.color === 'yellow' ? 'bg-yellow-500' :
                           'bg-blue-500';

        html += `
          <div class="border-2 ${bgColor} rounded-lg p-4">
            <div class="flex justify-between items-center">
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                  <span class="text-2xl font-bold text-gray-400">#${idx + 1}</span>
                  <div>
                    <h3 class="font-bold text-gray-800">${pattern.code} - ${pattern.name}</h3>
                    <p class="text-xs text-gray-600">${pattern.questionCount} questions | Raw avg: ${pattern.rawAverage}/4.0</p>
                  </div>
                </div>
              </div>
              <div class="text-right">
                <div class="flex items-center gap-3">
                  <span class="px-3 py-1 ${badgeColor} text-white text-xs font-bold rounded-full">
                    ${pattern.severity}
                  </span>
                  <span class="text-3xl font-bold text-gray-800">${pattern.score}%</span>
                </div>
              </div>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2 mt-3">
              <div class="${badgeColor} h-2 rounded-full transition-all" style="width: ${pattern.score}%"></div>
            </div>
          </div>
        `;
      });
      html += `</div>`;

      // Summary stats
      const highCount = data.scores.filter(s => s.score >= 60).length;
      const mediumCount = data.scores.filter(s => s.score >= 40 && s.score < 60).length;
      const lowCount = data.scores.filter(s => s.score < 40).length;

      html += `
        <div class="bg-gray-50 rounded-xl p-6 mt-6">
          <h3 class="text-xl font-bold text-gray-800 mb-4">üìà Summary Statistics</h3>
          <div class="grid grid-cols-3 gap-4">
            <div class="text-center">
              <p class="text-3xl font-bold text-red-500">${highCount}</p>
              <p class="text-sm text-gray-600">High (60-100%)</p>
            </div>
            <div class="text-center">
              <p class="text-3xl font-bold text-yellow-500">${mediumCount}</p>
              <p class="text-sm text-gray-600">Medium (40-59%)</p>
            </div>
            <div class="text-center">
              <p class="text-3xl font-bold text-blue-500">${lowCount}</p>
              <p class="text-sm text-gray-600">Low (0-39%)</p>
            </div>
          </div>
        </div>
      `;

      container.innerHTML = html;
    }

    // Generate all reports
    const clientData = generateClientReport();
    const teenCareerData = generateSelfAssessment(60, teenCareerImprints, 'Teen Career');
    const teenADHDData = generateSelfAssessment(48, teenADHDImprints, 'Teen ADHD');
    const parentADHDData = generateSelfAssessment(48, teenADHDImprints, 'Parent ADHD');

    // Render all reports
    renderReport(clientData, 'client-results', 'Client Report');
    renderReport(teenCareerData, 'teen-career-results', 'Teen Career');
    renderReport(teenADHDData, 'teen-adhd-results', 'Teen ADHD');
    renderReport(parentADHDData, 'parent-adhd-results', 'Parent ADHD');
  </script>
</body>
</html>
