const fs = require('fs');

// Read questions
const questionsData = JSON.parse(fs.readFileSync('./src/data/nip3/questions.json', 'utf8'));
const questions = questionsData.questions || questionsData;

// Read answers from database result
const answers = {
  "1":{"value":0,"option":"Not at all true of me","questionId":1},"2":{"value":0,"option":"Not at all true of me","questionId":2},"3":{"value":0,"option":"Not at all true of me","questionId":3},"4":{"value":1,"option":"A little true of me","questionId":4},"5":{"value":0,"option":"Not at all true of me","questionId":5},"6":{"value":3,"option":"Completely true of me","questionId":6},"7":{"value":3,"option":"Completely true of me","questionId":7},"8":{"value":0,"option":"Not at all true of me","questionId":8},"9":{"value":1,"option":"A little true of me","questionId":9},"10":{"value":1,"option":"A little true of me","questionId":10},"11":{"value":0,"option":"Not at all true of me","questionId":11},"12":{"value":0,"option":"Not at all true of me","questionId":12},"13":{"value":3,"option":"Completely true of me","questionId":13},"14":{"value":0,"option":"Not at all true of me","questionId":14},"15":{"value":0,"option":"Not at all true of me","questionId":15},"16":{"value":3,"option":"Completely true of me","questionId":16},"17":{"value":0,"option":"Not at all true of me","questionId":17},"18":{"value":2,"option":"Often true of me","questionId":18},"19":{"value":3,"option":"Completely true of me","questionId":19},"20":{"value":0,"option":"Not at all true of me","questionId":20},"21":{"value":3,"option":"Completely true of me","questionId":21},"22":{"value":3,"option":"Completely true of me","questionId":22},"23":{"value":0,"option":"Not at all true of me","questionId":23},"24":{"value":2,"option":"Often true of me","questionId":24},"25":{"value":3,"option":"Completely true of me","questionId":25},"26":{"value":3,"option":"Completely true of me","questionId":26},"27":{"value":0,"option":"Not at all true of me","questionId":27},"28":{"value":0,"option":"Not at all true of me","questionId":28},"29":{"value":1,"option":"A little true of me","questionId":29},"30":{"value":3,"option":"Completely true of me","questionId":30},"31":{"value":1,"option":"A little true of me","questionId":31},"32":{"value":1,"option":"A little true of me","questionId":32},"33":{"value":0,"option":"Not at all true of me","questionId":33},"34":{"value":3,"option":"Completely true of me","questionId":34},"35":{"value":1,"option":"A little true of me","questionId":35},"36":{"value":3,"option":"Completely true of me","questionId":36},"37":{"value":3,"option":"Completely true of me","questionId":37},"38":{"value":3,"option":"Completely true of me","questionId":38},"39":{"value":0,"option":"Not at all true of me","questionId":39},"40":{"value":3,"option":"Completely true of me","questionId":40},"41":{"value":3,"option":"Completely true of me","questionId":41},"42":{"value":0,"option":"Not at all true of me","questionId":42},"43":{"value":1,"option":"A little true of me","questionId":43},"44":{"value":0,"option":"Not at all true of me","questionId":44},"45":{"value":0,"option":"Not at all true of me","questionId":45},"46":{"value":1,"option":"A little true of me","questionId":46},"47":{"value":1,"option":"A little true of me","questionId":47},"48":{"value":0,"option":"Not at all true of me","questionId":48},"49":{"value":0,"option":"Not at all true of me","questionId":49},"50":{"value":0,"option":"Not at all true of me","questionId":50},"51":{"value":1,"option":"A little true of me","questionId":51},"52":{"value":0,"option":"Not at all true of me","questionId":52},"53":{"value":0,"option":"Not at all true of me","questionId":53},"54":{"value":1,"option":"A little true of me","questionId":54},"55":{"value":0,"option":"Not at all true of me","questionId":55},"56":{"value":1,"option":"A little true of me","questionId":56},"57":{"value":0,"option":"Not at all true of me","questionId":57},"58":{"value":1,"option":"A little true of me","questionId":58},"59":{"value":3,"option":"Completely true of me","questionId":59},"60":{"value":0,"option":"Not at all true of me","questionId":60},"61":{"value":3,"option":"Completely true of me","questionId":61},"62":{"value":0,"option":"Not at all true of me","questionId":62},"63":{"value":3,"option":"Completely true of me","questionId":63},"64":{"value":3,"option":"Completely true of me","questionId":64},"65":{"value":3,"option":"Completely true of me","questionId":65},"66":{"value":3,"option":"Completely true of me","questionId":66},"67":{"value":0,"option":"Not at all true of me","questionId":67},"68":{"value":0,"option":"Not at all true of me","questionId":68},"69":{"value":0,"option":"Not at all true of me","questionId":69},"70":{"value":3,"option":"Completely true of me","questionId":70},"71":{"value":3,"option":"Completely true of me","questionId":71},"72":{"value":3,"option":"Completely true of me","questionId":72},"73":{"value":0,"option":"Not at all true of me","questionId":73},"74":{"value":1,"option":"A little true of me","questionId":74},"75":{"value":2,"option":"Often true of me","questionId":75},"76":{"value":1,"option":"A little true of me","questionId":76},"77":{"value":2,"option":"Often true of me","questionId":77},"78":{"value":0,"option":"Not at all true of me","questionId":78},"79":{"value":1,"option":"A little true of me","questionId":79},"80":{"value":3,"option":"Completely true of me","questionId":80},"81":{"value":2,"option":"Often true of me","questionId":81},"82":{"value":3,"option":"Completely true of me","questionId":82},"83":{"value":3,"option":"Completely true of me","questionId":83},"84":{"value":0,"option":"Not at all true of me","questionId":84},"85":{"value":3,"option":"Completely true of me","questionId":85},"86":{"value":3,"option":"Completely true of me","questionId":86},"87":{"value":3,"option":"Completely true of me","questionId":87},"88":{"value":3,"option":"Completely true of me","questionId":88},"89":{"value":1,"option":"A little true of me","questionId":89},"90":{"value":2,"option":"Often true of me","questionId":90},"91":{"value":1,"option":"A little true of me","questionId":91},"92":{"value":2,"option":"Often true of me","questionId":92},"93":{"value":2,"option":"Often true of me","questionId":93},"94":{"value":0,"option":"Not at all true of me","questionId":94},"95":{"value":3,"option":"Completely true of me","questionId":95},"96":{"value":0,"option":"Not at all true of me","questionId":96},"97":{"value":0,"option":"Not at all true of me","questionId":97},"98":{"value":3,"option":"Completely true of me","questionId":98},"99":{"value":2,"option":"Often true of me","questionId":99},"100":{"value":2,"option":"Often true of me","questionId":100},"101":{"value":3,"option":"Completely true of me","questionId":101},"102":{"value":0,"option":"Not at all true of me","questionId":102},"103":{"value":0,"option":"Not at all true of me","questionId":103},"104":{"value":3,"option":"Completely true of me","questionId":104},"105":{"value":0,"option":"Not at all true of me","questionId":105},"106":{"value":0,"option":"Not at all true of me","questionId":106},"107":{"value":3,"option":"Completely true of me","questionId":107},"108":{"value":0,"option":"Not at all true of me","questionId":108},"109":{"value":0,"option":"Not at all true of me","questionId":109},"110":{"value":1,"option":"A little true of me","questionId":110},"111":{"value":0,"option":"Not at all true of me","questionId":111},"112":{"value":0,"option":"Not at all true of me","questionId":112},"113":{"value":0,"option":"Not at all true of me","questionId":113},"114":{"value":3,"option":"Completely true of me","questionId":114},"115":{"value":0,"option":"Not at all true of me","questionId":115},"116":{"value":3,"option":"Completely true of me","questionId":116},"117":{"value":3,"option":"Completely true of me","questionId":117},"118":{"value":0,"option":"Not at all true of me","questionId":118},"119":{"value":3,"option":"Completely true of me","questionId":119},"120":{"value":0,"option":"Not at all true of me","questionId":120},"121":{"value":1,"option":"A little true of me","questionId":121},"122":{"value":0,"option":"Not at all true of me","questionId":122},"123":{"value":1,"option":"A little true of me","questionId":123},"124":{"value":3,"option":"Completely true of me","questionId":124},"125":{"value":3,"option":"Completely true of me","questionId":125},"126":{"value":3,"option":"Completely true of me","questionId":126},"127":{"value":1,"option":"A little true of me","questionId":127},"128":{"value":2,"option":"Often true of me","questionId":128},"129":{"value":0,"option":"Not at all true of me","questionId":129},"130":{"value":1,"option":"A little true of me","questionId":130},"131":{"value":1,"option":"A little true of me","questionId":131},"132":{"value":0,"option":"Not at all true of me","questionId":132},"133":{"value":3,"option":"Completely true of me","questionId":133},"134":{"value":3,"option":"Completely true of me","questionId":134},"135":{"value":1,"option":"A little true of me","questionId":135},"136":{"value":3,"option":"Completely true of me","questionId":136},"137":{"value":1,"option":"A little true of me","questionId":137},"138":{"value":3,"option":"Completely true of me","questionId":138},"139":{"value":3,"option":"Completely true of me","questionId":139},"140":{"value":1,"option":"A little true of me","questionId":140},"141":{"value":2,"option":"Often true of me","questionId":141},"142":{"value":0,"option":"Not at all true of me","questionId":142},"143":{"value":2,"option":"Often true of me","questionId":143},"144":{"value":3,"option":"Completely true of me","questionId":144},"145":{"value":3,"option":"Completely true of me","questionId":145},"146":{"value":0,"option":"Not at all true of me","questionId":146},"147":{"value":0,"option":"Not at all true of me","questionId":147},"148":{"value":0,"option":"Not at all true of me","questionId":148},"149":{"value":3,"option":"Completely true of me","questionId":149},"150":{"value":3,"option":"Completely true of me","questionId":150},"151":{"value":3,"option":"Completely true of me","questionId":151},"152":{"value":0,"option":"Not at all true of me","questionId":152},"153":{"value":3,"option":"Completely true of me","questionId":153},"154":{"value":1,"option":"A little true of me","questionId":154},"155":{"value":0,"option":"Not at all true of me","questionId":155},"156":{"value":0,"option":"Not at all true of me","questionId":156},"157":{"value":3,"option":"Completely true of me","questionId":157},"158":{"value":0,"option":"Not at all true of me","questionId":158},"159":{"value":1,"option":"A little true of me","questionId":159},"160":{"value":2,"option":"Often true of me","questionId":160},"161":{"value":3,"option":"Completely true of me","questionId":161},"162":{"value":0,"option":"Not at all true of me","questionId":162},"163":{"value":0,"option":"Not at all true of me","questionId":163},"164":{"value":0,"option":"Not at all true of me","questionId":164},"165":{"value":1,"option":"A little true of me","questionId":165},"166":{"value":1,"option":"A little true of me","questionId":166},"167":{"value":3,"option":"Completely true of me","questionId":167},"168":{"value":1,"option":"A little true of me","questionId":168},"169":{"value":0,"option":"Not at all true of me","questionId":169},"170":{"value":1,"option":"A little true of me","questionId":170},"171":{"value":3,"option":"Completely true of me","questionId":171},"172":{"value":2,"option":"Often true of me","questionId":172},"173":{"value":0,"option":"Not at all true of me","questionId":173},"174":{"value":0,"option":"Not at all true of me","questionId":174},"175":{"value":0,"option":"Not at all true of me","questionId":175},"176":{"value":3,"option":"Completely true of me","questionId":176},"177":{"value":3,"option":"Completely true of me","questionId":177},"178":{"value":2,"option":"Often true of me","questionId":178},"179":{"value":0,"option":"Not at all true of me","questionId":179},"180":{"value":0,"option":"Not at all true of me","questionId":180},"181":{"value":0,"option":"Not at all true of me","questionId":181},"182":{"value":0,"option":"Not at all true of me","questionId":182},"183":{"value":1,"option":"A little true of me","questionId":183},"184":{"value":2,"option":"Often true of me","questionId":184},"185":{"value":0,"option":"Not at all true of me","questionId":185},"186":{"value":2,"option":"Often true of me","questionId":186},"187":{"value":2,"option":"Often true of me","questionId":187},"188":{"value":3,"option":"Completely true of me","questionId":188},"189":{"value":1,"option":"A little true of me","questionId":189},"190":{"value":1,"option":"A little true of me","questionId":190},"191":{"value":2,"option":"Often true of me","questionId":191},"192":{"value":2,"option":"Often true of me","questionId":192},"193":{"value":0,"option":"Not at all true of me","questionId":193},"194":{"value":0,"option":"Not at all true of me","questionId":194},"195":{"value":1,"option":"A little true of me","questionId":195},"196":{"value":1,"option":"A little true of me","questionId":196},"197":{"value":2,"option":"Often true of me","questionId":197},"198":{"value":3,"option":"Completely true of me","questionId":198},"199":{"value":3,"option":"Completely true of me","questionId":199},"200":{"value":3,"option":"Completely true of me","questionId":200},"201":{"value":3,"option":"Completely true of me","questionId":201},"202":{"value":1,"option":"A little true of me","questionId":202},"203":{"value":1,"option":"A little true of me","questionId":203},"204":{"value":0,"option":"Not at all true of me","questionId":204},"205":{"value":0,"option":"Not at all true of me","questionId":205},"206":{"value":3,"option":"Completely true of me","questionId":206},"207":{"value":0,"option":"Not at all true of me","questionId":207},"208":{"value":0,"option":"Not at all true of me","questionId":208},"209":{"value":3,"option":"Completely true of me","questionId":209},"210":{"value":2,"option":"Often true of me","questionId":210},"211":{"value":3,"option":"Completely true of me","questionId":211},"212":{"value":2,"option":"Often true of me","questionId":212},"213":{"value":0,"option":"Not at all true of me","questionId":213},"214":{"value":3,"option":"Completely true of me","questionId":214},"215":{"value":0,"option":"Not at all true of me","questionId":215},"216":{"value":0,"option":"Not at all true of me","questionId":216},"217":{"value":0,"option":"Not at all true of me","questionId":217},"218":{"value":0,"option":"Not at all true of me","questionId":218},"219":{"value":0,"option":"Not at all true of me","questionId":219},"220":{"value":0,"option":"Not at all true of me","questionId":220},"221":{"value":0,"option":"Not at all true of me","questionId":221},"222":{"value":3,"option":"Completely true of me","questionId":222},"223":{"value":0,"option":"Not at all true of me","questionId":223},"224":{"value":1,"option":"A little true of me","questionId":224},"225":{"value":3,"option":"Completely true of me","questionId":225},"226":{"value":0,"option":"Not at all true of me","questionId":226},"227":{"value":3,"option":"Completely true of me","questionId":227},"228":{"value":1,"option":"A little true of me","questionId":228},"229":{"value":3,"option":"Completely true of me","questionId":229},"230":{"value":0,"option":"Not at all true of me","questionId":230},"231":{"value":2,"option":"Often true of me","questionId":231},"232":{"value":3,"option":"Completely true of me","questionId":232},"233":{"value":1,"option":"A little true of me","questionId":233},"234":{"value":3,"option":"Completely true of me","questionId":234},"235":{"value":0,"option":"Not at all true of me","questionId":235},"236":{"value":1,"option":"A little true of me","questionId":236},"237":{"value":2,"option":"Often true of me","questionId":237},"238":{"value":0,"option":"Not at all true of me","questionId":238},"239":{"value":3,"option":"Completely true of me","questionId":239},"240":{"value":0,"option":"Not at all true of me","questionId":240},"241":{"value":0,"option":"Not at all true of me","questionId":241},"242":{"value":3,"option":"Completely true of me","questionId":242},"243":{"value":0,"option":"Not at all true of me","questionId":243},"244":{"value":0,"option":"Not at all true of me","questionId":244},"245":{"value":3,"option":"Completely true of me","questionId":245},"246":{"value":3,"option":"Completely true of me","questionId":246},"247":{"value":0,"option":"Not at all true of me","questionId":247},"248":{"value":3,"option":"Completely true of me","questionId":248},"249":{"value":2,"option":"Often true of me","questionId":249},"250":{"value":0,"option":"Not at all true of me","questionId":250},"251":{"value":0,"option":"Not at all true of me","questionId":251},"252":{"value":0,"option":"Not at all true of me","questionId":252},"253":{"value":0,"option":"Not at all true of me","questionId":253},"254":{"value":0,"option":"Not at all true of me","questionId":254},"255":{"value":3,"option":"Completely true of me","questionId":255},"256":{"value":3,"option":"Completely true of me","questionId":256},"257":{"value":1,"option":"A little true of me","questionId":257},"258":{"value":0,"option":"Not at all true of me","questionId":258},"259":{"value":3,"option":"Completely true of me","questionId":259},"260":{"value":0,"option":"Not at all true of me","questionId":260},"261":{"value":3,"option":"Completely true of me","questionId":261},"262":{"value":3,"option":"Completely true of me","questionId":262},"263":{"value":0,"option":"Not at all true of me","questionId":263},"264":{"value":0,"option":"Not at all true of me","questionId":264},"265":{"value":3,"option":"Completely true of me","questionId":265},"266":{"value":0,"option":"Not at all true of me","questionId":266},"267":{"value":3,"option":"Completely true of me","questionId":267},"268":{"value":0,"option":"Not at all true of me","questionId":268},"269":{"value":0,"option":"Not at all true of me","questionId":269},"270":{"value":0,"option":"Not at all true of me","questionId":270},"271":{"value":3,"option":"Completely true of me","questionId":271},"272":{"value":3,"option":"Completely true of me","questionId":272},"273":{"value":0,"option":"Not at all true of me","questionId":273},"274":{"value":0,"option":"Not at all true of me","questionId":274},"275":{"value":1,"option":"A little true of me","questionId":275},"276":{"value":0,"option":"Not at all true of me","questionId":276},"277":{"value":1,"option":"A little true of me","questionId":277},"278":{"value":1,"option":"A little true of me","questionId":278},"279":{"value":3,"option":"Completely true of me","questionId":279},"280":{"value":2,"option":"Often true of me","questionId":280},"281":{"value":0,"option":"Not at all true of me","questionId":281},"282":{"value":1,"option":"A little true of me","questionId":282},"283":{"value":1,"option":"A little true of me","questionId":283},"284":{"value":2,"option":"Often true of me","questionId":284},"285":{"value":3,"option":"Completely true of me","questionId":285},"286":{"value":3,"option":"Completely true of me","questionId":286},"287":{"value":0,"option":"Not at all true of me","questionId":287},"288":{"value":0,"option":"Not at all true of me","questionId":288},"289":{"value":3,"option":"Completely true of me","questionId":289},"290":{"value":0,"option":"Not at all true of me","questionId":290},"291":{"value":3,"option":"Completely true of me","questionId":291},"292":{"value":0,"option":"Not at all true of me","questionId":292},"293":{"value":0,"option":"Not at all true of me","questionId":293},"294":{"value":1,"option":"A little true of me","questionId":294},"295":{"value":1,"option":"A little true of me","questionId":295},"296":{"value":1,"option":"A little true of me","questionId":296},"297":{"value":2,"option":"Often true of me","questionId":297},"298":{"value":3,"option":"Completely true of me","questionId":298},"299":{"value":2,"option":"Often true of me","questionId":299},"300":{"value":0,"option":"Not at all true of me","questionId":300},"301":{"value":3,"option":"Completely true of me","questionId":301},"302":{"value":0,"option":"Not at all true of me","questionId":302},"303":{"value":3,"option":"Completely true of me","questionId":303},"304":{"value":3,"option":"Completely true of me","questionId":304},"305":{"value":0,"option":"Not at all true of me","questionId":305},"306":{"value":0,"option":"Not at all true of me","questionId":306},"307":{"value":3,"option":"Completely true of me","questionId":307},"308":{"value":2,"option":"Often true of me","questionId":308},"309":{"value":0,"option":"Not at all true of me","questionId":309},"310":{"value":3,"option":"Completely true of me","questionId":310},"311":{"value":3,"option":"Completely true of me","questionId":311},"312":{"value":0,"option":"Not at all true of me","questionId":312},"313":{"value":0,"option":"Not at all true of me","questionId":313},"314":{"value":1,"option":"A little true of me","questionId":314},"315":{"value":2,"option":"Often true of me","questionId":315},"316":{"value":2,"option":"Often true of me","questionId":316},"317":{"value":2,"option":"Often true of me","questionId":317},"318":{"value":1,"option":"A little true of me","questionId":318},"319":{"value":3,"option":"Completely true of me","questionId":319},"320":{"value":2,"option":"Often true of me","questionId":320},"321":{"value":1,"option":"A little true of me","questionId":321},"322":{"value":1,"option":"A little true of me","questionId":322},"323":{"value":3,"option":"Completely true of me","questionId":323},"324":{"value":3,"option":"Completely true of me","questionId":324},"325":{"value":0,"option":"Not at all true of me","questionId":325},"326":{"value":1,"option":"A little true of me","questionId":326},"327":{"value":0,"option":"Not at all true of me","questionId":327},"328":{"value":0,"option":"Not at all true of me","questionId":328},"329":{"value":3,"option":"Completely true of me","questionId":329},"330":{"value":3,"option":"Completely true of me","questionId":330},"331":{"value":0,"option":"Not at all true of me","questionId":331},"332":{"value":3,"option":"Completely true of me","questionId":332},"333":{"value":0,"option":"Not at all true of me","questionId":333},"334":{"value":1,"option":"A little true of me","questionId":334},"335":{"value":3,"option":"Completely true of me","questionId":335},"336":{"value":0,"option":"Not at all true of me","questionId":336},"337":{"value":3,"option":"Completely true of me","questionId":337},"338":{"value":3,"option":"Completely true of me","questionId":338},"339":{"value":0,"option":"Not at all true of me","questionId":339},"340":{"value":0,"option":"Not at all true of me","questionId":340},"341":{"value":1,"option":"A little true of me","questionId":341},"342":{"value":0,"option":"Not at all true of me","questionId":342},"343":{"value":3,"option":"Completely true of me","questionId":343}
};

// NIP definitions with proper names
const NIP_NAMES = {
  'NIP01': 'Emotional Deprivation',
  'NIP02': 'Abandonment/Instability',
  'NIP03': 'Mistrust/Abuse',
  'NIP04': 'Social Isolation/Alienation',
  'NIP05': 'Defectiveness/Shame',
  'NIP06': 'Failure',
  'NIP07': 'Dependence/Incompetence',
  'NIP08': 'Vulnerability to Harm or Illness',
  'NIP09': 'Enmeshment/Undeveloped Self',
  'NIP10': 'Subjugation',
  'NIP11': 'Self-Sacrifice',
  'NIP12': 'Emotional Inhibition',
  'NIP13': 'Unrelenting Standards/Hypercriticalness',
  'NIP14': 'Entitlement/Grandiosity',
  'NIP15': 'Insufficient Self-Control/Self-Discipline',
  'NIP16': 'Approval-Seeking/Recognition-Seeking',
  'NIP17': 'Negativity/Pessimism',
  'NIP18': 'Punitiveness',
  'NIP19': 'Approval-Seeking/Recognition-Seeking',
  'NIP20': 'Negativity/Pessimism'
};

// Group questions by NIP
const nipGroups = {};
questions.forEach(q => {
  if (!nipGroups[q.nipCode]) {
    nipGroups[q.nipCode] = [];
  }
  nipGroups[q.nipCode].push(q);
});

// Calculate scores for each NIP
const results = [];
Object.keys(NIP_NAMES).forEach(nipCode => {
  const nipQuestions = nipGroups[nipCode] || [];
  let actualScore = 0;
  const totalQuestions = nipQuestions.length;
  const maxScore = totalQuestions * 3;

  nipQuestions.forEach(q => {
    const answer = answers[q.id.toString()];
    if (answer) {
      let score = answer.value;

      // Apply reverse scoring if needed
      if (q.reverseScored) {
        score = 3 - score;
      }

      actualScore += score;
    }
  });

  const percentage = totalQuestions > 0 ? Math.round((actualScore / maxScore) * 100) : 0;

  results.push({
    code: nipCode,
    name: NIP_NAMES[nipCode],
    score: percentage,
    actualScore,
    maxScore,
    totalQuestions
  });
});

// Sort by percentage
results.sort((a, b) => b.score - a.score);

// Calculate overall score
const overallScore = Math.round(results.reduce((sum, r) => sum + r.score, 0) / results.length);

const analysis = {
  completedAt: "2025-12-11T18:19:39.343+00:00",
  overallScore,
  totalQuestions: 343,
  neuralImprintPatternScores: results
};

console.log(JSON.stringify(analysis, null, 2));
